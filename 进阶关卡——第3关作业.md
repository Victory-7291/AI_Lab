
# 进阶关卡——第3关作业

    
## 任务1：4A16量化与kv cache量化的internlm2_5-1_8b-chat模型封装本地API并与
### 

    应用场景：
        KV Cache int4/int8量化主要用于优化KV Cache结构中的键和值的存储和访问。
        W4A16量化通常用于整个模型的权重和激活值。

    量化粒度：
        KV Cache int4/int8量化可以应用于键和值，而W4A16量化是针对权重和激活值的。

    精度与效率的权衡：
        W4A16量化通过使用更多的位来表示激活值，提供了比KV Cache int4/int8量化更高的精度。
        KV Cache int4/int8量化更注重减少存储需求和加速访问，可能会牺牲一些精度。

    校准过程：
        两者都需要校准，但校准的数据和目标可能不同，因为它们优化的是不同的数据类型。
    
    kv cache:
        是一种缓存技术，通过存储键值对的形式来复用计算结果，以达到提高性能和降低内存消耗的目的。

<br>量化前lmdepoly chat的显存占用:
  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-29%2014-23-23.png "2024-11-20%2010-52-40.png")

  
-------------------------------------------------------------------------------------------------------------------  
  
<br>启动W4A16量化:
  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-28%2021-37-18.png "2024-11-20%2010-52-40.png")

  
-------------------------------------------------------------------------------------------------------------------

  
量化后的InternLM2.5_1.8B_chat减少2.5GB的文件大小:

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-28%2022-35-12.png "2024-11-20%2016-23-28.png")

  
-------------------------------------------------------------------------------------------------------------------


lmdepoly chat 验证启动模型查看显存占用: 

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-29%2010-44-36.png "2024-11-20%2016-23-28.png")

  
-------------------------------------------------------------------------------------------------------------------


使用lmdeploy启动本地模型api服务 + KV Cache int4 + KV Cache：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-29%2011-31-58.png "2024-11-20%2021-42-15.png")

  
-------------------------------------------------------------------------------------------------------------------


新建终端，使用Gradio作为前端，启动网页：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-29%2011-35-09.png "2024-11-20%2021-42-31.png")

  
-------------------------------------------------------------------------------------------------------------------


在浏览器中与本地模型交互：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-29%2011-35-50.png "2024-11-20%2021-43-08.png")

  
-------------------------------------------------------------------------------------------------------------------


查看显存：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-29%2011-40-13.png "2024-11-20%2021-43-50.png")

  
-------------------------------------------------------------------------------------------------------------------


## 任务2: 使用Function call
###

启动api服务：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-29%2015-08-27.png "2024-11-20%2021-42-31.png")

  
-------------------------------------------------------------------------------------------------------------------


使用function call：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-29%2015-08-50.png "2024-11-20%2021-43-08.png")

  
-------------------------------------------------------------------------------------------------------------------


输出结果：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-29%2015-09-48.png "2024-11-20%2021-43-50.png")

  
-------------------------------------------------------------------------------------------------------------------
