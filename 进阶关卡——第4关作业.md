


# 进阶关卡——第4关作业

    
## 基础任务：
### 理解多模态大模型的常见设计模式，可以大概讲出多模态大模型的工作原理：


按照教程配置环境，准备数据，模型，然后修改config文件：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-23%2010-50-52.png "2024-11-20%2010-52-40.png")

  
-------------------------------------------------------------------------------------------------------------------

  
### 了解InternVL2的设计模式，可以大概描述InternVL2的模型架构和训练流程：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-11-23%2010-51-16.png "2024-11-20%2016-23-28.png")

  
-------------------------------------------------------------------------------------------------------------------


### 了解LMDeploy部署多模态大模型的核心代码，并运行提供的gradio代码，在UI界面体验与InternVL2的对话：


按照教程配置环境，运行demo,与InternVL2交互：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-12-12%2019-27-54.png "2024-11-20%2021-42-15.png")

  
-------------------------------------------------------------------------------------------------------------------


微调前，错把肠粉认成叉烧：


![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-12-14%2010-07-15.png "2024-11-20%2021-42-31.png")

  
-------------------------------------------------------------------------------------------------------------------


### 了解XTuner，并利用给定数据集微调InternVL2-2B后，再次启动UI界面，体验模型美食鉴赏能力的变化:


在xtuner/xtuner/config中添加InternVL2-2B微调的配置文件：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-12-12%2020-05-49.png "2024-11-20%2021-43-08.png")

  
-------------------------------------------------------------------------------------------------------------------


启动微调：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-12-12%2020-37-18.png "2024-11-20%2021-42-31.png")

  
-------------------------------------------------------------------------------------------------------------------


内存溢出，超出30%A100显存两倍左右：

![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-12-12%2021-03-19.png "2024-11-20%2021-42-15.png")

  
-------------------------------------------------------------------------------------------------------------------


修改config文件中的bitch_size从4改为2，微调完成：

![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-12-13%2021-23-49.png "2024-11-20%2021-43-08.png")

  
-------------------------------------------------------------------------------------------------------------------


借助已有的权重文件转换脚本，把.pth格式的权重文件转换为.safetensors：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-12-13%2021-44-22.png "2024-11-20%2021-43-50.png")

  
-------------------------------------------------------------------------------------------------------------------


修改demo.py中模型的路径，然后运行：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-12-13%2021-49-43.png "2024-11-20%2021-43-50.png")

  
-------------------------------------------------------------------------------------------------------------------


微调后的模型成功识别了肠粉：

  
![erro](https://github.com/Victory-7291/AI_Lab/raw/main/images/2024-12-14%2010-15-06.png "2024-11-20%2021-42-31.png")

  
-------------------------------------------------------------------------------------------------------------------

